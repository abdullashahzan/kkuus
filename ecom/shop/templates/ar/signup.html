{% extends "ar/layout.html" %}
{% load static %}

{% block body %}
<main>
    <div class="container d-none d-lg-block">
        <div class="row" style="min-height: 80vh;">
            <div class="col-md-6 d-flex justify-content-center align-items-center">
                <img class="widthlock" src="{% static 'media/undraw_sign_up_n6im.svg' %}" alt="ØµÙˆØ±Ø©">
            </div>
            <div class="col-md-6 d-flex justify-content-start align-items-center p-5">
                <article>
                    <h1 class="style-heading mb-4">!Ù†Ø¹ØªØ°Ø±ØŒ ÙˆÙ„ÙƒÙ† Ø¹Ù„ÙŠÙƒ Ù…Ù„Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù…Ù„ Ù„Ù„ØªØ³Ø¬ÙŠÙ„ Ù„ØªØ³Ø¬ÙŠÙ„ Ù†ÙØ³Ùƒ ğŸ˜©</h1>
                    <form action="{% url 'shop:signup_user' %}" method="post" class="style-text" id="myForm">
                        {% csrf_token %}
                        <div class="row mb-2">
                            <div class="col-md-6">
                                <label for="first" class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„</label>
                                <input type="text" class="form-control" name="first" id="web_first" placeholder="Ù…Ø­Ù…Ø¯">
                            </div>
                            <div class="col-md-6">
                                <label for="second" class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
                                <input type="text" class="form-control" name="second" id="web_second" placeholder="Ø³Ù…Ø¨ÙˆÙ„">
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-12">
                                <label for="whatsapp" class="form-label">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
                                <input type="text" class="form-control" name="whatsapp" id="web_whatsapp"
                                    placeholder="Ù…Ø«Ø§Ù„: +966509338765">
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-12">
                                <label for="username" class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                                <input type="text" class="form-control" name="username" id="userInput" placeholder="JoJo"
                                    aria-describedby="checkUsernameAvailability" oninput="delayFunction()">
                                <div id="checkUsernameAvailability" class="form-text"></div>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-12">
                                <label for="email" class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                <input type="email" class="form-control" name="email" id="web_email"
                                    placeholder="Ù…Ø«Ø§Ù„: my_email@gmail.com">
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-md-6">
                                <label for="exampleInputPassword1" class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                <input type="password" name="password" class="form-control" placeholder="ilovecupcakes">
                            </div>
                            <div class="col-md-6">
                                <label for="exampleInputPassword2" class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                <input type="password" name="password2" class="form-control" placeholder="ilovecupcakes">
                            </div>
                        </div>
                        <div class="row mb-4">
                            <label for="address" class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙƒÙ† Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</label>
                            <div class="col-md-6">
                                <input type="text" class="form-control" name="room_no" id="address"
                                    placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØºØ±ÙØªÙƒ" aria-describedby="address_help">
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <select class="form-control" id="building_code" name="building_code">
                                        <option value="0">Ø§Ø®ØªØ± Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø³ÙƒÙ† Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</option>
                                        <option value="br1">BR1</option>
                                        <option value="br2">BR2</option>
                                        <option value="br3">BR3</option>
                                        <option value="br4">BR4</option>
                                        <option value="br5">BR5</option>
                                        <option value="br6">BR6</option>
                                        <option value="br7">BR7</option>
                                        <option value="br8">BR8</option>
                                        <option value="br9">BR9</option>
                                        <option value="br10">BR10</option>
                                    </select>
                                </div>
                            </div>
                            <div id="address_help" class="form-text">ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø¹Ù†ÙˆØ§Ù†Ùƒ ÙˆØ¥Ù„Ø§ Ø³ÙŠØªÙ„Ù‚Ù‰ Ø·Ù„Ø¨Ùƒ Ø´Ø®Øµ Ø¢Ø®Ø± ğŸ’€</div>
                        </div>
                        {% if message %}
                        <p class="style-text" style="color: red;">{{message}}</p>
                        {% endif %}
                        <button type="submit" class="btn btn-primary my-2">ØªØ³Ø¬ÙŠÙ„</button><br>
                        <a href="{% url 'shop:login_user' %}" type="submit"
                            class="btn btn-light btn-outline-primary">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ</a>
                    </form>
                </article>
            </div>
        </div>
    </div>
    <div class="container d-block d-lg-none justify-content-center align-items-center mb-4" style="min-height: 80vh;">
        <div class="col-12">
            <div class="card shadow animate__animated animate__zoomIn">
                <img class="widthlock p-2" src="{% static 'media/undraw_sign_up_n6im.svg' %}" alt="ØµÙˆØ±Ø© ÙØ§Ø±ØºØ©">
                <div class="card-body">
                    <article>
                        <h1 class="style-heading mb-4">Ù†Ø¹ØªØ°Ø±ØŒ ÙˆÙ„ÙƒÙ† Ø¹Ù„ÙŠÙƒ Ù…Ù„Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù…Ù„ Ù„Ù„ØªØ³Ø¬ÙŠÙ„ Ù„ØªØ³Ø¬ÙŠÙ„ Ù†ÙØ³Ùƒ ğŸ˜©!</h1>
                        <form action="{% url 'shop:signup_user' %}" method="post" class="style-text" id="myForm">
                            {% csrf_token %}
                            <div class="row mb-2">
                                <div class="col-md-6">
                                    <label for="first" class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„</label>
                                    <input type="text" class="form-control" name="first" id="first">
                                </div>
                                <div class="col-md-6">
                                    <label for="second" class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
                                    <input type="text" class="form-control" name="second" id="second">
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-md-12">
                                    <label for="whatsapp" class="form-label">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
                                    <input type="text" class="form-control" name="whatsapp" id="whatsapp"
                                        placeholder="Ù…Ø«Ø§Ù„: +966509338765">
                                    <div id="address_help" class="form-text">ØªØ£ÙƒØ¯ Ù…Ù† ÙƒØªØ§Ø¨Ø© Ø±Ù…Ø² Ø§Ù„Ø¨Ù„Ø¯ Ø§Ù„ØµØ­ÙŠØ­ Ù…Ø¹ "+" ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©. Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù„Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ø£Ùˆ Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ùƒ.</div>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-md-12">
                                    <label for="username" class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                                    <input type="text" class="form-control" name="username" id="userInput"
                                        aria-describedby="checkUsernameAvailability" oninput="delayFunction()">
                                    <div id="checkUsernameAvailability" class="form-text"></div>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-md-12">
                                    <label for="email" class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                    <input type="email" class="form-control" name="email" id="email" aria-describedby="email_help">
                                    <div id="address_help" class="form-text">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù†Ø´Ø·. Ù†Ø­Ù† Ù†Ø³ØªØ®Ø¯Ù…Ù‡ Ù„Ø¥Ø±Ø³Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø­ÙˆÙ„ Ø·Ù„Ø¨Ø§ØªÙƒ.</div>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-md-6">
                                    <label for="exampleInputPassword1" class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                    <input type="password" name="password" class="form-control">
                                </div>
                                <div class="col-md-6">
                                    <label for="exampleInputPassword2" class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                    <input type="password" name="password2" class="form-control">
                                </div>
                            </div>
                            <div class="row mb-4">
                                <label for="address" class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙƒÙ† Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" name="room_no" id="web_address"
                                        placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØºØ±ÙØªÙƒ" aria-describedby="address_help">
                                </div>
                                <div class="col-md-6 my-2">
                                    <div class="form-group">
                                        <select class="form-control" id="building_code" name="building_code">
                                            <option value="0">Ø§Ø®ØªØ± Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø³ÙƒÙ† Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</option>
                                            <option value="br1">BR1</option>
                                            <option value="br2">BR2</option>
                                            <option value="br3">BR3</option>
                                            <option value="br4">BR4</option>
                                            <option value="br5">BR5</option>
                                            <option value="br6">BR6</option>
                                            <option value="br7">BR7</option>
                                            <option value="br8">BR8</option>
                                            <option value="br9">BR9</option>
                                            <option value="br10">BR10</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div id="address_help" class="form-text">ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø¹Ù†ÙˆØ§Ù†Ùƒ ÙˆØ¥Ù„Ø§ Ø³ÙŠØªÙ„Ù‚Ù‰ Ø·Ù„Ø¨Ùƒ Ø´Ø®Øµ Ø¢Ø®Ø± ğŸ’€</div>
                            {% if message %}
                            <p class="style-text" style="color: red;">{{message}}</p>
                            {% endif %}
                            <button type="submit" class="btn btn-primary my-2">ØªØ³Ø¬ÙŠÙ„</button><br>
                            <a href="{% url 'shop:login_user' %}" type="submit"
                                class="btn btn-light btn-outline-primary">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ</a>
                        </form>
                    </article>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    let timeoutId;
    let functionCalled = false;

    function delayFunction() {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
            if (!functionCalled) {
                checkUsername();
                functionCalled = true;
            }
        }, 2000);
        functionCalled = false;
    }

    function checkUsername() {

        var messageBox = document.getElementById('checkUsernameAvailability');
        var csrfToken = document.getElementsByName('csrfmiddlewaretoken')[0].value;
        var userInput = document.getElementById('userInput');
        var userInputValue = userInput.value;

        if (userInputValue == "") {
            html_data = `<p class="style-text" style="color: red;">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºÙ‹Ø§</p>`
            messageBox.innerHTML = html_data;
        } else {
            fetch(`/username_availability/${userInputValue}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': csrfToken,
                },
                body: 'user_input=' + encodeURIComponent(userInputValue),
            })
                .then(response => response.json())
                .then(data => {
                    var html_data;
                    console.log(data.response)
                    if (data.response == "available") {
                        html_data = `<p class="style-text" style="color: green;">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØ§Ø­</p>`
                        messageBox.innerHTML = html_data;
                    }
                    else if (data.response == "not available") {
                        html_data = `<p class="style-text" style="color: red;">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¬ÙˆØ² Ø¨Ø§Ù„ÙØ¹Ù„</p>`
                        messageBox.innerHTML = html_data;
                    }
                });
        }
    }

    // Function to save form data to localStorage
    function saveFormData() {
        const formData = {
            first: document.getElementById('first').value,
            second: document.getElementById('second').value,
            whatsapp: document.getElementById('whatsapp').value,
            username: document.getElementById('userInput').value,
            email: document.getElementById('email').value,
            address: document.getElementById('address').value,

            web_first: document.getElementById('web_first').value,
            web_second: document.getElementById('web_second').value,
            web_whatsapp: document.getElementById('web_whatsapp').value,
            web_email: document.getElementById('web_email').value,
            web_address: document.getElementById('web_address').value,
        };

        localStorage.setItem('formData', JSON.stringify(formData));
    }

    // Function to load form data from localStorage
    function loadFormData() {
        const savedData = localStorage.getItem('formData');
        if (savedData) {
            const formData = JSON.parse(savedData);
            document.getElementById('first').value = formData.first;
            document.getElementById('second').value = formData.second;
            document.getElementById('whatsapp').value = formData.whatsapp;
            document.getElementById('userInput').value = formData.username;
            document.getElementById('email').value = formData.email;
            document.getElementById('address').value = formData.address;

            document.getElementById('web_first').value = formData.web_first;
            document.getElementById('web_second').value = formData.web_second;
            document.getElementById('web_whatsapp').value = formData.web_whatsapp;
            document.getElementById('web_email').value = formData.web_email;
            document.getElementById('web_address').value = formData.web_address;
        }
    }

    // Listen for changes in the form fields and save data to localStorage
    document.getElementById('myForm').addEventListener('change', saveFormData);

    // Load form data from localStorage when the page loads
    window.addEventListener('load', loadFormData);
</script>
{% endblock %}
