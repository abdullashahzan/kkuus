{% extends 'layout.html' %}
{% load static %}

{% block title %}
<title>My orders</title>
{% endblock %}

{% block body %}
{% if not first_visit %}
<div class="notice">
    <div class="card p-md-3 p-2 mx-4 col-md-6 bg-dark shadow animate__animated animate__zoomIn">
        <div class="card-body">
            <h1 class="style-text-3 text-light">This is your orders page</h1>
            <p class="style-text-2 text-light">
                All the products that you buy will appear here. You can see your item's status updates, seller details like their
                whatsapp number and their address etc. 
            </p>
            <div class="style-text mt-4">
                <button class="btn btn-light" onclick="document.querySelector('.notice').style.display='none';">Alright!</button>
            </div>
        </div>
    </div>
</div>
{% endif %}
<div class="container-fluid bg-light">
    <div class="row bg-light p-md-3 py-3 px-1">
        <div class="col-md-8">
            <article>
                <h1 class="display-1 style-text-3 ">My orders</h1>
                <p class="style-text">
                    All the products that you buy show up on this page. Here you can see their status updates that is
                    if they have been accepted, rejected or are still being requested. You can also see the
                    OTP, seller details or cancel your order.
                </p>
            </article>
        </div>
        <div class="col-md-4 d-none d-md-flex justify-content-center align-items-center">
            <img src="../static/media/undraw_order_delivered_re_v4ab.svg" alt="image" style="height: 10rem; width: auto;">
        </div>
    </div>
    <div class="row bg-dark p-md-4 p-3">
        <h1 class="display-4 style-text-3 text-light">Your orders</h1>
    </div>
    <div class="row p-md-4 py-4 p-2">
        {% for order in orders %}
        <div class="col-md-6">
            <div class="card mb-3 bg-dark shadow">
                <div class="card-header text-light style-text-3">
                    {% if order.status == "requested" %}
                    <span class="text-danger">Requested</span>
                    (seller has been informed about your order)
                    {% else %}
                    <span class="text-success">Accepted</span>
                    (seller will be contacting you soon)
                    {% endif %}
                </div>
                <div class="row g-0">
                    <div class="col-md-5">
                        <img class="product_image" src="{% url 'shop:get_image' order.item.firebase_path %}" class="card-img-top" alt="{{order.item.product_name}}">
                    </div>
                    <div class="col-md-7 text-light">
                        <div class="card-body">
                            <h5 class="card-title style-text-3 display-6 truncate-1-lines">{{order.item.product_name}}</h5>
                            <h5 class="card-title style-text-3">{{order.item.product_price}} x {{order.quantity}} = <span class="text-danger">{% widthratio order.item.product_price 1 order.quantity %} SAR</span> </h5>
                            <hr>
                            <h5 class="style-text-3">OTP: <span class="text-danger">{{order.key}}</span></h5>
                            <p class="style-text text-light">Don't share your OTP with anyone except the seller himself.</p>
                            <div class="style-text-2 row px-1">
                                <div class="col-md-6 p-1">
                                    <a href="{% url 'shop:buy' order.item.id %}" class="btn btn-outline-light" style="width: 100%;">View item</a>
                                </div>
                                <div class="col-md-6 p-1">
                                    <a href="https://wa.me/{{whatsapp}}?text=Hello there! I would like to know if the product *{{item.product_name}}* is still available?
                
                                    unstore.pythonanywhere.com/buy/{{item.id}}" target="_blank"
                                        class="btn btn-outline-light" title="Message seller on whatsapp" style="width: 100%;">Contact seller</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer style-text text-light row text-md-center">
                        <div class="col-md-7">
                            <strong>Seller address:</strong> Room {{order.room_no}}, Building {{order.building_code}}
                        </div>
                        <div class="col-md-5">
                            <strong>Whatsapp:</strong> {{order.whatsapp}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="display-4 style-text-3" style="min-height: 60vh;">
            You have not ordered anything yet...
        </div>
        {% endfor %}
    </div>
</div>


{% endblock %}